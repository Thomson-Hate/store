<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HATE STORE</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif; background:#111; color:#fff; min-height:100vh; overflow-x:hidden; display:flex; flex-direction:column; }
a { color:inherit; text-decoration:none; }

/* TOP BAR */
.top-bar{ position:fixed; top:14px; left:50%; transform:translateX(-50%); width:95%; max-width:1200px; height:75px; border-radius:24px; padding:0 26px; display:flex;align-items:center;justify-content:space-between; backdrop-filter:blur(18px) saturate(180%); background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.25); box-shadow:0 8px 35px rgba(0,0,0,0.35); z-index:1000; transition:.4s; }
.top-bar b{ font-size:1.4rem; font-weight:700; }

/* TOGGLE */
.toggle{ width:270px;height:38px; background:rgba(255,255,255,0.08); border-radius:25px; display:flex;position:relative; backdrop-filter:blur(14px) saturate(180%); border:1px solid rgba(255,255,255,0.25); overflow:hidden; }
.toggle button{ flex:1;border:none;background:none;color:#fff; font-size:.9rem;font-weight:500;cursor:pointer; z-index:2;transition:.3s; }
.toggle button.active{ font-weight:600; text-shadow:0 0 6px rgba(255,255,255,0.85); }
.slider{ position:absolute;top:0;left:0; width:33.333%;height:100%; border-radius:25px; backdrop-filter:blur(28px) saturate(320%); background:rgba(255,255,255,0.25); border:1px solid rgba(255,255,255,0.42); box-shadow: inset 0 0 15px rgba(255,255,255,.35),0 0 25px rgba(255,255,255,.55); transition:left .55s cubic-bezier(.18,.8,.35,1.25); }

/* CONTAINER */
.container{ width:92%; max-width:1100px; margin:120px auto 50px; padding:40px; border-radius:30px; background:rgba(255,255,255,0.05); backdrop-filter:blur(25px) saturate(180%); border:1px solid rgba(255,255,255,0.12); }
.search{ width:100%; padding:14px; border-radius:16px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); color:#fff; margin-bottom:20px; }

/* CATEGORIES & SUBCATEGORIES */
.categories{display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
.cat{ padding:10px 18px; border-radius:16px; background:rgba(255,255,255,.08); cursor:pointer; transition:.3s; font-weight:500; }
.cat:hover,.cat.active{ background:rgba(255,255,255,.28); box-shadow:0 0 18px rgba(255,255,255,.35); }

/* PRODUCTS */
.products{ display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:20px; }
.product{ position: relative; padding:15px; border-radius:22px; background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.12); cursor:pointer; transition:.35s; z-index:1; }
.product:hover{ transform:translateY(-6px) scale(1.03); box-shadow:0 0 40px rgba(255,255,255,.35), inset 0 0 20px rgba(255,255,255,.08); z-index:10; }
.product img{ width:100%; border-radius:16px; }
.old{ opacity:.5;text-decoration:line-through;font-size:.9rem; }
.sale{ color:#ff4d4d;font-weight:600; }

/* MODAL */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.75); display:none; align-items:center; justify-content:center; }
.modal.show{display:flex;}
.modal-card{ width:430px; padding:25px; border-radius:26px; background:rgba(0,0,0,.88); backdrop-filter:blur(35px); border:1px solid rgba(255,255,255,.12);}
.colors{display:flex;gap:10px;margin:15px 0;align-items:center;}
.color{ width:26px;height:26px;border-radius:50%; border:2px solid #fff;cursor:pointer;transition:.3s; position:relative; }
.color:hover{transform:scale(1.15)}
.color.active{box-shadow:0 0 25px #fff,0 0 40px rgba(255,255,255,.35);}
.color .status{ position:absolute; bottom:-6px; left:50%; transform:translateX(-50%); font-size:.6rem; color:#fff; background:rgba(0,0,0,.5); padding:1px 4px; border-radius:6px; }
.color.unavailable{ opacity:.35; pointer-events:none; }
.gallery{display:flex;gap:8px;margin-top:10px;}
.gallery img{width:55px;height:55px;object-fit:cover;border-radius:10px;cursor:pointer;opacity:.6;transition:.3s;}
.gallery img:hover{opacity:1;transform:scale(1.05)}
.gallery img.active{opacity:1;border:2px solid #fff;}
.buy{margin-top:15px;padding:12px;border-radius:14px;background:rgba(255,255,255,.22);text-align:center;cursor:pointer;transition:.3s;}
.buy:hover{box-shadow:0 0 30px rgba(255,255,255,.35);}
footer{ margin-top:auto; padding:28px 0; background:rgba(255,255,255,0.05); backdrop-filter:blur(18px); border-top:1px solid rgba(255,255,255,0.18); text-align:center; }
</style>
</head>
<body>

<div id="app"></div>

<script>
async function loadStore() {
    try {
        const res = await fetch('store.json?t=' + Date.now());
        const STORE = await res.json();
        initStore(STORE);
    } catch (err) {
        console.error(err);
        document.getElementById("app").innerHTML = `<div style="text-align:center;margin-top:100px;color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>`;
    }
}

function initStore(STORE){
    const app = document.getElementById("app");
    if(STORE.maintenance){
        app.innerHTML = `<div style="text-align:center;margin-top:100px;">
            <h2>üöß –í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã</h2>
            <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ <a href="${STORE.telegram}" target="_blank">Telegram</a></p>
        </div>`;
        return;
    }

    app.innerHTML = `
        <div class="top-bar">
            <b>HATE STORE</b>
            <div class="toggle">
                <div class="slider" id="slider"></div>
                <button class="active" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
                <button data-tab="about">–û –Ω–∞—Å</button>
                <button data-tab="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
            </div>
        </div>
        <div class="container" id="shop">
            <input class="search" id="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞...">
            <div class="categories" id="categories"></div>
            <div class="categories" id="subCategories"></div>
            <div class="products" id="products"></div>
        </div>
        <div class="container" id="about" hidden>–û –Ω–∞—Å</div>
        <div class="container" id="contacts" hidden>Telegram</div>
        <div class="modal" id="modal">
            <div class="modal-card">
                <img id="modalImg" style="width:100%;border-radius:18px">
                <div class="gallery" id="gallery"></div>
                <h2 id="modalName"></h2>
                <p id="modalDesc"></p>
                <div class="colors" id="modalColors"></div>
                <div id="modalPrice"></div>
                <div class="buy" id="buyBtn">–ö—É–ø–∏—Ç—å</div>
            </div>
        </div>
        <footer>¬© 2025 ‚Ä¢ HATE STORE</footer>
    `;

    const slider = document.getElementById("slider");
    document.querySelectorAll(".toggle button").forEach((b,i)=>{
        b.onclick = ()=>{
            document.querySelectorAll(".toggle button").forEach(x=>x.classList.remove("active"));
            b.classList.add("active");
            slider.style.left = i*33.333+"%";
            ["shop","about","contacts"].forEach(id=>document.getElementById(id).hidden=true);
            document.getElementById(b.dataset.tab).hidden=false;
        }
    });

    const search = document.getElementById("search");
    let currentCategory = STORE.categories[0]?.id;
    let currentSub = STORE.categories[0]?.sub?.[0]?.id || null;

    function renderCategories(){
        const catCont = document.getElementById("categories");
        catCont.innerHTML="";
        STORE.categories.forEach(c=>{
            const el=document.createElement("div");
            el.className="cat"+(c.id===currentCategory?" active":"");
            el.textContent=c.name;
            el.onclick=()=>{
                currentCategory=c.id;
                currentSub=c.sub?.[0]?.id||null;
                renderCategories();
                renderSubCategories(c);
                renderProducts();
            };
            catCont.appendChild(el);
        });
    }

    function renderSubCategories(cat){
        const subCont = document.getElementById("subCategories");
        subCont.innerHTML="";
        if(!cat.sub?.length) return;
        cat.sub.forEach(s=>{
            const el=document.createElement("div");
            el.className="cat"+(s.id===currentSub?" active":"");
            el.textContent=s.name;
            el.onclick=()=>{
                currentSub=s.id;
                renderSubCategories(cat);
                renderProducts();
            };
            subCont.appendChild(el);
        });
    }

    function renderProducts(){
        const productsEl=document.getElementById("products");
        productsEl.innerHTML="";
        STORE.products
            .filter(p=>p.categories.includes(currentCategory))
            .filter(p=>!currentSub||p.categories.includes(currentSub))
            .filter(p=>p.name.toLowerCase().includes(search.value.toLowerCase()))
            .forEach(p=>{
                const final=p.discount?p.price*(1-p.discount/100):p.price;
                const d=document.createElement("div");
                d.className="product";
                d.innerHTML=`<img src="${p.colors[0].images[0]}"><h3>${p.name}</h3>${p.discount?`<div class="old">${p.price}‚ÇΩ</div><div class="sale">${final}‚ÇΩ</div>`:`<div>${p.price}‚ÇΩ</div>`}`;
                d.onclick=()=>openModal(p);
                productsEl.appendChild(d);
            });
    }

    search.oninput = renderProducts;
    renderCategories();
    renderSubCategories(STORE.categories[0]);
    renderProducts();

    // ===== MODAL WITH STOCK STATUS =====
    function openModal(p){
        const modal=document.getElementById("modal");
        modal.classList.add("show");
        document.getElementById("modalName").textContent=p.name;
        document.getElementById("modalDesc").textContent=p.desc;
        document.getElementById("modalColors").innerHTML="";
        const gallery=document.getElementById("gallery");
        gallery.innerHTML="";
        const final=p.discount?p.price*(1-p.discount/100):p.price;
        document.getElementById("modalPrice").innerHTML=p.discount?`<span class="old">${p.price}‚ÇΩ</span> <span class="sale">${final}‚ÇΩ</span>`:`${p.price}‚ÇΩ`;

        function setColor(c){
            document.getElementById("modalImg").src=c.images[0];
            gallery.innerHTML="";
            c.images.forEach((img,i)=>{
                const im=document.createElement("img");
                im.src=img;
                if(i==0) im.classList.add("active");
                im.onclick=()=>{
                    document.querySelectorAll(".gallery img").forEach(x=>x.classList.remove("active"));
                    im.classList.add("active");
                    document.getElementById("modalImg").src=img;
                };
                gallery.appendChild(im);
            });
        }

        p.colors.forEach((c,i)=>{
            const col=document.createElement("div");
            col.className="color"+(i==0?" active":"")+(c.stock===false?" unavailable":"");
            col.style.background=c.hex;
            const status=document.createElement("span");
            status.className="status";
            status.textContent=c.stock===false?"–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏":"–í –Ω–∞–ª–∏—á–∏–∏";
            col.appendChild(status);
            col.onclick=()=>{ 
                if(c.stock===false) return;
                document.querySelectorAll(".color").forEach(x=>x.classList.remove("active"));
                col.classList.add("active");
                setColor(c);
            };
            document.getElementById("modalColors").appendChild(col);
        });

        setColor(p.colors[0]);

        document.getElementById("buyBtn").onclick=()=>window.open(STORE.telegram,"_blank");
        modal.onclick=e=>{if(e.target===modal) modal.classList.remove("show");};
    }
}

loadStore();
</script>
</body>
</html>
